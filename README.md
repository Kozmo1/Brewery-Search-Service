# Brewery-Search-Service

Created by Joel Attard, Shahyar Fida, Mike Kraemer, Julia Lebedzeva

This project is a Node.js-based microservice for searching across inventory, orders, users, and reviews in an e-commerce application, developed as part of a group project for Open Source Web Programming at Conestoga College. It pulls data from the Brewery Database Service via RESTful APIs, filters it based on query params, and paginates results. We built it with TypeScript, Express, and Jest to keep it solid, secure, and testable—aiming for 90%+ branch coverage. The service uses `dotenv-safe` to load environment variables from `.env.local` by default or based on `NODE_ENV`. Key settings include the server port (default: 3007), Brewery API URL (default: http://localhost:5089), and a JWT secret for auth. The `SearchController` class handles everything, using Axios for API calls and express-validator for input checks.

To get started, clone the repo from `C:\git\Brewery-Search-Service` (or your fork), then run `npm install` to grab dependencies like `express`, `axios`, `jsonwebtoken`, `dotenv-safe`, and `express-validator`. For dev work, add `typescript`, `jest`, `@types/*` packages, and `ts-node` with `npm install --save-dev`. Set up a `.env.local` file with `PORT`, `JWT_SECRET`, `BREWERY_API_URL`, and `NODE_ENV`, using `.env.example` as a guide. Start the service with `npm start` (assuming `ts-node src/index.ts`), or compile with `npm run build` and run `node dist/index.js`. Test it with `npm run test` to hit Jest with coverage—shooting for 100%.

The project’s laid out with `src/config/config.ts` for env setup, `src/controllers/searchController.ts` for the core logic, `src/middleware/auth.ts` for JWT checks, and `src/index.ts` to kick things off. Tests are in `src/config/__tests__/config.test.ts` and `src/controllers/__tests__/searchController.test.ts`, mocking Axios and express-validator. Below are the endpoints, all under `/search` and expecting JSON content type. Protected routes need a Bearer token in the `Authorization` header.

1. `GET /inventory` - Searches inventory by query, type, or flavor. Example request: `GET /search/inventory?query=beer&type=Beer&flavor=Hoppy&page=1&limit=1`. Success response (200): `{"results": [{"Id": 1, "Name": "Hoppy Beer", "Type": "Beer", "TasteProfile": {"PrimaryFlavor": "Hoppy"}}], "total": 1}`. Error (400): `{"errors": [{"msg": "Page must be a positive integer"}]}`.
2. `GET /orders` - Searches orders by query or status (authenticated). Example request: `GET /search/orders?query=1&status=Pending&page=1&limit=1` with header `Authorization: Bearer <token>`. Success response (200): `{"results": [{"Id": 1, "UserId": 1, "TotalPrice": 10.99, "Status": "Pending"}], "total": 1}`. Error (400): `{"errors": [{"msg": "Limit must be a positive integer"}]}`.
3. `GET /users` - Searches users by query (authenticated). Example request: `GET /search/users?query=joel&page=1&limit=1` with header `Authorization: Bearer <token>`. Success response (200): `{"results": [{"Id": 1, "Name": "Joel", "Email": "joel@example.com"}], "total": 1}`. Error (401): `{"message": "Authentication required"}`.
4. `GET /reviews` - Searches reviews by query. Example request: `GET /search/reviews?query=great&page=1&limit=1`. Success response (200): `{"results": [{"Id": 1, "UserId": 1, "ProductId": 1, "ReviewRating": 4, "ReviewMessage": "Great beer"}], "total": 1}`. Error (400): `{"errors": [{"msg": "Page must be a positive integer"}]}`.
